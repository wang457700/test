{include file="layout/public_head" /}
	<body style="background: url(__TMPL_PUBLIC__/img/login_bg.jpg) repeat center;background-size: cover !important;">

	 <div class="container">

       <div class="row">
	        <div class="col-md-5 col-xs-11 login" style="">
				<img src="__TMPL_PUBLIC__/img/logo-3.png" class="logo3">
    			<form action="{:url('user/login')}" class="form-horizontal" method="post" enctype="multipart/form-data" onsubmit="return loginform()" id="login-form">
	        		<div class="form-group label1">
                      <label for="exampleInputEmail1"></label>
                      <input type="email" class="form-control" id="email" placeholder="電郵" data-toggle="tooltip" title="請輸入您的電郵" name="email" required>
                    </div>
                    <div class="form-group label2">
                      <label for="exampleInputEmail1"></label>
                       <input type="password" class="form-control" id="password" placeholder="密碼"  data-toggle="tooltip" name="password" title="請輸入您的密碼" required>
                    </div>
				  <div class="form-group" style="border: 0;">
				     <label style="width: 40%;"><input type="checkbox" style="width: 20%;">記住密碼</label>
				     <a href="{:url('user/forgetpwd')}" class="color_ro" style="float: right">忘記密碼 找回？</a>
				  </div>
					<div class="form-group" style="border: 0;">
				  		<button type="submit" class="btn btn-success btn-success-edit" style="margin-bottom: 1em"  id="login">登    錄</button>
						<button type="button" class="btn btn-default btn-default-edit" style="margin-bottom: 1em">Facebook 客戶登錄</button>
						<button type="button" class="btn btn-default btn-default-edit" style="margin-bottom: 1em" id="customBtn" >Google 客戶登錄</button>
					 	<button type="button" class="btn btn-default btn-default-edit"><img src="__TMPL_PUBLIC__/img/logo-weixin.png" style="width:  30px;margin-right:  10px;">Wechat 登錄</button>

					</div>
					<div style="text-align: center;">
						<a href="{:url('User/register')}">註冊會員</a>
					</div>
				</form> 
			</div> 
		</div>

		 <button type="button" onclick="signOut();">Sign out</button>

		 <script src="https://cdn.bootcss.com/jquery.form/4.2.2/jquery.form.min.js"></script>
		<script src="__TMPL_PUBLIC__/js/scripts.js"></script>
		 <script src="https://apis.google.com/js/api:client.js"></script>
		 <script>
             var googleUser = {};
             var startApp = function() {
                 gapi.load('auth2', function(){
                     // Retrieve the singleton for the GoogleAuth library and set up the client.
                     auth2 = gapi.auth2.init({
                         client_id: '974658843640-ban0u40f04qahk5lkl9kl1sj06cfmvi4.apps.googleusercontent.com', //客户端ID
                         cookiepolicy: 'single_host_origin',
                         scope: 'https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email' //可以请求除了默认的'profile' and 'email'之外的数据
                     });
                     attachSignin(document.getElementById('customBtn'));
                 });
             };
             function attachSignin(element) {
                 auth2.attachClickHandler(element, {},
                     function(googleUser) {
                        // document.getElementById('name').innerText = "Signed in: " + googleUser.getBasicProfile().getName();
                         var profile = auth2.currentUser.get().getBasicProfile();
                         console.log('ID: ' + profile.getId());
                         console.log('Full Name: ' + profile.getName());
                         console.log('Given Name: ' + profile.getGivenName());
                         console.log('Family Name: ' + profile.getFamilyName());
                         console.log('Image URL: ' + profile.getImageUrl());
                         console.log('Email: ' + profile.getEmail());

                         console.log(profile);
                         $.ajax({
                             type: "POST",
                             url: "{:url('api/user/third')}?platform=google",
                             dataType: 'json',
                             data: profile,
                             success: function(data) {
                                 if(data.code == 0){
                                     $.message({message:data.msg,type:'warning',time:'3000'});
                                 }else{
                                     $.message(data.msg);
                                     setTimeout(function () {
                                         window.location = "{:url('user/center')}";
                                     },1500);
                                 }
                             }
                         });

                     }, function(error) {
                         console.log(JSON.stringify(error, undefined, 2));
                     });
             }
             startApp();

             //注销
             function signOut() {
                 var auth2 = gapi.auth2.getAuthInstance();
                 auth2.signOut().then(function () {
                     alert('用户注销成功');
                 });
             }
		 </script>
		 {include file="common/script" /}
		<script type="text/javascript">
			function loginform(){
				var email = $('#email');
				var reg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/; //定义一个正则表达式
				if(!reg.test(email.val())){
					$.message({message:'電郵格式不正确！',type:'warning'});
					email.focus();
					return false;
				} 
			
				// jquery 表单提交
				$("#login-form").ajaxSubmit(function(data) {
					console.log(data);
					if(data.code == 0){
						$.message({message:data.msg,type:'warning',time:'3000'});
					}else{ 
						$.message(data.msg);
						setTimeout(function () {
						  	window.location = data.url
					  	},1500);
					}
				});

				return false; //必须返回false，否则表单会自己再做一次提交操作，并且页面跳转
			}
		</script>
	</body>
</html>