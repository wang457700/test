{include file="layout/public_head" /}
	<style>
		.mui-card .mui-control-content {padding: 10px;}
		.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active{border-bottom: 2px solid #FFAA00;color: #FFAA00;}
		.my_order .mui-btn{ position: relative;transform: inherit;right: 0;}
	</style>
	<body>

	<form action="{:url('cart/action_cart')}"  method="post" enctype="multipart/form-data" onsubmit="return orderform()" id="order-form">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #7ac141;"></a>
			<h1 class="mui-title">確認訂單</h1>
		</header>

		<nav class="mui-bar mui-bar-tab" style="box-shadow: 0 0 1px rgba(0, 0, 0, 0.15);line-height: 50px;">
			<button type="submit" class="mui-btn mui-btn-success mui-pull-right" style="margin-right: 10px;">提交訂單</button>
			<p class="mui-pull-right" style="margin:0;margin-right: 20px;">合計：<span class="color_ro">$</span><span class="color_ro font18">{:number_format($all_total,2)}</span></p>
		</nav>

		<div class="mui-content my_order">

			{foreach name="address_list" item="vo"}
			<?php
				if($vo['default']==1){
					$address_default_id=$vo['id'];
				}
			?>
			{/foreach}
			{foreach name="address_list" item="vo"}
			{if condition="$vo['default']"}
			<ul class="mui-table-view">
				 <li class="mui-table-view-cell">
						<span><img src="__TMPL_PUBLIC__/img/empty.png" class="left_ico">收貨人：{$vo.name} </span>
						<span class="mui-pull-right">{$vo.phone}</span>
				 </li>
		         <li class="mui-table-view-cell">
		         	<a class="mui-navigate-right" style="padding-right: 35px;"> 
		         		<span><img src="__TMPL_PUBLIC__/img/diz2.png" class="left_ico">收貨地址：</span>
						<span class="mui-pull-right" >{$vo.province}{$vo.city}{$vo.district}<br>{$vo.address}</span>
					</a> 
		         </li>
			</ul>
			{/if}
			{/foreach}
			<input type="hidden" name="address_id" id="address_id" value="{$address_default_id|default='0'}">


			<ul class="mui-table-view" >
				 <li class="mui-table-view-cell"><i class="left_menu_ico i3"></i>健康及有機產品</li>
				{foreach name="order_list" item="vo"}
				<input type="hidden"  name="goods_id[]" value="{$vo.goods_id}" />
				<input type="hidden"  name="goods_num[]" value="{$vo.goods_num}" />
		         <li class="mui-table-view-cell l2">
		         	<img src="__PUBLIC__/{$vo.cover}" class=" mui-pull-left" />
			          <p class="p1">{$vo.product_name}</p>
			          <p>{$vo.model}</p>
			          <p><span class="color_ro">$</span><span class="color_ro font18">{:number_format($vo['price'],2)}</span><span class="mui-pull-right">x{$vo.goods_num}</span></p>
		         </li>
				{/foreach}
		         <li class="mui-table-view-cell"><a class="mui-navigate-right">配送方式<span class="mui-pull-right" style="margin-right: 20px;">快遞 免郵</span></a></li>

				<li class="mui-table-view-cell" style="text-align:right">
		         	共{$num}件商品    合計 <span class="color_ro">$</span><span class="color_ro font18">{:number_format($all_total,2)}</span>(含運費$0.00)
	        	</li>
			</ul>
		</div>
	</form>
		{include file="common/script" /}
		<script src="https://cdn.bootcss.com/jquery.form/4.2.2/jquery.form.min.js"></script>
		<script>
			mui('.mui-scroll-wrapper').scroll();


            function orderform(){
                //console.log($('#cart-form').serializeArray());
                var address_id = $('#address_id').val();
                if(address_id == ''){
                    $.message({message:'請選擇收貨地址！',type:'warning',time:'3000'});
                    return false;
                }
                if(address_id == 0){
                    $.message({message:'你還沒有添加收貨地址！',type:'warning',time:'3000'});
                    return false;
                }

                // jquery 表单提交
                $("#order-form").ajaxSubmit(function(data){
                    var data = $.parseJSON(data);
                    if(data.code == 0){
                        $.message({message:data.msg,type:'warning',time:'3000'});
                    }else{
                        $.message(data.msg);
                        setTimeout(function (){
                            window.location = data.order_url;
                        },1000);
                    }
                });
                return false; //必须返回false，否则表单会自己再做一次提交操作，并且页面跳转
            }
		</script>

	</body>

</html>